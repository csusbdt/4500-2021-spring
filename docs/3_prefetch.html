<html>
<head>
	<link rel="shortcut icon" type="image/png" href="images/icon-192x192.png">
</head>
<body>
	<div>
		Experiment 3: prefetch audio data
	</div>
	<div id="g_unstarted_div">
		<button id="g_click_to_start_button">click to start</button>
	</div>
	<div id="g_started_div">
		<button id="g_prefetch_music_button">prefetch music</button><br>
		<button id="g_play_music_button">play music</button><br>
		<div id="g_messages_div"></div>
	</div>
	<script type="module">
		import './3_error.js';
		import { create_audio_context, fetch_audio_buffer, play_audio_buffer } from './3_prefetch.js';

		/* global g_unstarted_div, g_started_div, g_messages_div */
		g_unstarted_div.style.display = 'block';
		g_started_div.style.display   = 'none';
		g_play_music_button.style.display = 'none';

		//const music_file = 'sfx/positive_click.mp3';
		const music_file = 'music/robins_and_roses.mp3';
		let audio_buffer = null;

		/* global g_click_to_start_button, g_prefetch_music_button, g_play_music_button */
		g_click_to_start_button.addEventListener('click', () => {
			create_audio_context();
			g_unstarted_div.style.display = 'none';
			g_started_div.style.display = 'block';
		}, { capture: true, once: true });

		g_prefetch_music_button.addEventListener('click', () => {
			fetch_audio_buffer(music_file).then(buffer => {
				g_messages_div.innerHTML += "<br>g_prefetch_music_button got audio_buffer";
				audio_buffer = buffer;
				g_play_music_button.style.display = 'inline-block';			
			});
		}, { capture: true, once: false });

		g_play_music_button.addEventListener('click', () => {
			play_audio_buffer(audio_buffer);
		}, { capture: true, once: false });
	</script>
</body>
</html>
