let audio_context=null;export function get_audio_context(){return null===audio_context&&(audio_context=new(window.AudioContext||window.webkitAudioContext)),"suspended"===audio_context.state&&(audio_context.resume(),"suspended"===audio_context.state)?null:audio_context}export function c_sound(e,t){this.file=e,this.volume=void 0===t?1:t,this.array_buffer=null,this.audio_buffer=null,this.buffer_source_node=null,this.gain_node=null,this.fetching=!1,this.decoding=!1}c_sound.prototype.load=function(){return this.fetch()},c_sound.prototype.unload=function(){return this.release_memory()},c_sound.prototype.fetch=function(){return null!==this.array_buffer?Promise.resolve(this.array_buffer):this.fetching?Promise.reject("fetching"):(this.fetching=!0,fetch(this.file).then((e=>{if(e.ok)return e.arrayBuffer();throw this.fetching=!1,new Error(e.status)})).then((e=>(this.array_buffer=e,this.fetching=!1,this.array_buffer))))},c_sound.prototype.decode=function(){return null!==this.audio_buffer?Promise.resolve(this.audio_buffer):this.decoding?Promise.reject("decoding"):(this.decoding=!0,this.fetch().then((e=>new Promise(((t,n)=>{const o=get_audio_context();if(null===o)return this.decoding=!1,n("no audio context");o.decodeAudioData(e,(e=>{this.audio_buffer=e,this.decoding=!1,t(e)}),(e=>{this.decoding=!1,n(e)}))})))))},c_sound.prototype.fast_play=function(){this.decode().then((e=>{const t=get_audio_context();if(null===t)return;const n=t.createBufferSource();n.buffer=e;const o=t.createGain();n.connect(o),o.connect(t.destination),o.gain.setValueAtTime(this.volume,t.currentTime),n.start()})).catch((()=>{}))},c_sound.prototype.play=function(){this.decode().then((e=>{if(null===this.buffer_source_node){const t=get_audio_context();if(null===t)return;this.buffer_source_node=t.createBufferSource(),this.buffer_source_node.buffer=e,this.gain_node=t.createGain(),this.buffer_source_node.connect(this.gain_node),this.gain_node.connect(t.destination),this.gain_node.gain.setValueAtTime(this.volume,t.currentTime),this.buffer_source_node.addEventListener("ended",(()=>{this.buffer_source_node=null,this.gain_node=null}),{once:!0}),this.buffer_source_node.start()}})).catch((()=>{}))},c_sound.prototype.stop=function(){null!==this.buffer_source_node&&this.buffer_source_node.stop()},c_sound.prototype.set_volume=function(e){null!==this.gain_node&&this.gain_node.gain.setValueAtTime(e,audio_context.currentTime)},c_sound.prototype.is_playing=function(){return null!==this.buffer_source_node},c_sound.prototype.release_memory=function(){this.audio_buffer=null,this.array_buffer=null,this.stop()};