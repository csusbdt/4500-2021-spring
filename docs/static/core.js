import{get_audio_context}from"/4500-2021-spring/static/c_sound.js";export const d_w=1920;export const d_h=1080;export const v_w=1920;export const v_h=1080;const spf=1/8,bg_ctx=g_bg.getContext("2d",{alpha:!1}),fg_ctx=g_fg.getContext("2d",{alpha:!0});let room=null,scale=1,offset_x=0,offset_y=0,left=0,top=0,bg=null,bg_dirty=!0;export function set_room(t){room=t}export function set_bg(t){bg=t,bg_dirty=!0}function adjust_canvas(){const t=window.innerWidth,o=window.innerHeight;scale=Math.min(1,t/v_w,o/v_h);const e=Math.min(t,d_w*scale),n=Math.min(o,d_h*scale);g_fg.width=e,g_bg.width=e,g_fg.height=n,g_bg.height=n,offset_x=(e-d_w*scale)/2,offset_y=(n-d_h*scale)/2,left=(t-e)/2,top=(o-n)/2,g_fg.style.left=left,g_bg.style.left=left,g_fg.style.top=top,g_bg.style.top=top,bg_ctx.setTransform(scale,0,0,scale,offset_x,offset_y),fg_ctx.setTransform(scale,0,0,scale,offset_x,offset_y),bg_dirty=!0}window.addEventListener("resize",adjust_canvas,!0),adjust_canvas();let previous_time=(new Date).getTime()/1e3;function animation_loop(){if(bg_dirty&&(null===bg?bg_ctx.clearRect(0,0,d_w,d_h):bg.draw(bg_ctx),bg_dirty=!1),null!==room){const t=(new Date).getTime()/1e3;let o=t-previous_time;previous_time=t,o>spf&&(o=spf),null!==room&&(fg_ctx.clearRect(0,0,d_w,d_h),room.render(o,fg_ctx))}requestAnimationFrame(animation_loop)}export const start_animation_loop=()=>{requestAnimationFrame(animation_loop)};const room_coords=t=>[(t.pageX-left-offset_x)/scale,(t.pageY-top-offset_y)/scale],mousedown=t=>{get_audio_context(),t.preventDefault(),null!==room&&room.on_touch(room_coords(t))},touchstart=t=>{get_audio_context(),t.preventDefault(),null!==room&&room.on_touch(room_coords(t.changedTouches[0]))};g_fg.addEventListener("mousedown",mousedown,{capture:!0,once:!1}),g_fg.addEventListener("touchstart",touchstart,{capture:!0,once:!1});