export const d_w=1920;export const d_h=1080;export const v_w=1920;export const v_h=1080;const spf=1/8,bg=g_bg.getContext("2d",{alpha:!0}),fg=g_fg.getContext("2d",{alpha:!0});export function set_renderer(e){f_render=e}export function get_renderer(){return f_render}export function set_on_touch(e){f_on_touch=e}let f_render=null,f_on_touch=null,scale=1,offset_x=0,offset_y=0,margin_left=0,margin_top=0,bg_image=null,bg_dirty=!1;function adjust_canvas(){const e=window.innerWidth,t=window.innerHeight;scale=Math.min(1,e/v_w,t/v_h);const n=Math.min(e,d_w*scale),o=Math.min(t,d_h*scale);g_fg.width=n,g_bg.width=n,g_fg.height=o,g_bg.height=o,offset_x=(n-d_w*scale)/2,offset_y=(o-d_h*scale)/2,margin_left=(e-n)/2,margin_top=(t-o)/2,g_fg.style["margin-left"]=margin_left,g_bg.style["margin-left"]=margin_left,g_fg.style["margin-top"]=margin_top,g_bg.style["margin-top"]=margin_top,bg.setTransform(scale,0,0,scale,offset_x,offset_y),fg.setTransform(scale,0,0,scale,offset_x,offset_y),bg_dirty=!0}window.addEventListener("resize",adjust_canvas,!0),adjust_canvas();export function set_bg(e){bg_image=e,bg_dirty=!0}let previous_time=(new Date).getTime()/1e3;function animation_loop(){bg_dirty&&(null===bg_image?bg.clearRect(0,0,d_w,d_h):bg.drawImage(bg_image,0,0),bg_dirty=!1);const e=(new Date).getTime()/1e3;let t=e-previous_time;previous_time=e,t>spf&&(t=spf),null!==f_render&&f_render(t),requestAnimationFrame(animation_loop)}requestAnimationFrame(animation_loop);const room_coords=e=>[(e.pageX-margin_left-offset_x)/scale,(e.pageY-margin_top-offset_y)/scale],mousedown=e=>{null!==f_on_touch&&(e.preventDefault(),f_on_touch(room_coords(e)))},touchstart=e=>{null!==f_on_touch&&(e.preventDefault(),f_on_touch(room_coords(e.changedTouches[0])))};g_ui_div.addEventListener("mousedown",mousedown,{capture:!0,once:!1}),g_ui_div.addEventListener("touchstart",touchstart,{capture:!0,once:!1});